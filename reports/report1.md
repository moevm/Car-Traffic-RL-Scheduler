# Разработка планирования дорожного трафика с помощью Reinforcement Learning

## Запуск

Для запуска симулятора с графическим интерфейсом с заданной конфигурацией (например, newconf.sumocfg) необходимо воспользоваться следующей командой:

```bash
sumo-gui -c newconf.sumocfg
```

Для запуска без графического интерфейса:

```bash
sumo -c newconf.sumocfg
```

В файле с конфигурацией должен быть указан файл конфигурации сети и маршрута, которые можно создать с помощью утилиты следующей графическим интерфейсом:

```bash
netedit
```

Для корректной работы редактора необходимо задать переменную окружения следующим образом (в случае установки SUMO через apt):

```bash
export SUMO_HOME="/usr/share/sumo"
```
В данной утилите сетью является граф, в котором дороги -- это рёбра, а вершины -- сущности для соединения дорог. Сеть дополняется маршрутами и транспортными средствами.

Формат всех конфигурационных файлов должен иметь расширение XML.

## API

В качестве API для SUMO используется TraCI, который можно установить с помощью следующей команды:

```bash
pip install traci
```

Перед установкой TraCI следует создать виртуальное окружение.

С помощью данного API можно получать данные о симуляции, а также управлять процессами внутри неё.

Простой пример кода с использованием данного API:

```python
import traci
sumo_cmd = ["sumo", "-c", "myconf.sumoconf"]
traci.start(sumo_cmd) # запуск симуляции
while traci.simulation.getMinExpectedNumber() > 0: #пока есть транспортные средства на карте
    traci.simulationStep() # сделать шаг симуляции
traci.close() # закрыть симуляцию
```
TraCI предоставляет большое количество методов для получения информации о симуляции в данный момент времени:

1. Информацию о транспортных средствах (например, скорость, ускорение, масса);
2. Информацию о людях (например, скорость, координаты);
3. Информацию о маршрутах (например, id рёбер, входящих в маршрут);
4. Информацию о вершинах (например, id входящих и выходящих рёбер);
5. Информацию о рёбрах (например, количество электроэнергии в кВт, потраченное на преодоление данного ребра за последний шаг симуляции);
6. Информацию о светофорах (например, длительность красного, жёлтого и зелёного цвета);
7. Информацию о остановках (например, количество ждущих людей на данной остановке);
8. Информация о зарядных станциях (например, мощность зарядной станции в Вт);
9. Информация о парковочных зонах (например, число автомобилей на парковочной зоне);
10. Общая информация, например, такая как время внутри симуляции, количество автомобилей, достигших точки назначения, суммарное количество автомобилей на парковках.
    
С помощью данного API можно менять следующие состояния:

1. Состояние транспортных средств (например, скорость, замедление, ехать задним ходом);
2. Состояние людей (например, скорость, размеры);
3. Состояние маршрута (например, добавить маршрут в виде списка рёбер);
4. Состояние рёбер (например, установить максимальную скорость на ребре);
5. Состояние полосы (например, каким классам нельзя появляться на полосе, максимальная скорость);
6. Состояние зарядной станции (например, задержка перед следующей зарядкой);
7. Состояние симуляции (например, заменить текущее состояние симуляции на симуляцию из файла);

Пример использования некоторых методов API представлен ниже:

```python
import traci
sumo_cmd = ["sumo-gui", "-c", "myconf.sumocfg"]
traci.start(sumo_cmd) # запуск симуляции
while traci.simulation.getMinExpectedNumber() > 0: # пока есть транспортные средства на карте
    traci.simulationStep() # сделать шаг симуляции
    if 'v_0' in traci.vehicle.getIDList(): # есть ли автомобиль с таким ID на карте в данный момент
        traci.vehicle.setSpeed('v_9', 1) # установить для него скорость 1 м/c
        print(traci.vehicle.getSpeed('v_9')) # удостовериться, что скорость установлена
traci.close() # закрыть симуляцию
```

## Итоги итерации

1. Настроена среда и запущен симулятор с заданной конфигурацией.
2. Изучены некоторые параметры конфигураций сети и маршрутов с помощью утилиты netedit.
3. Настроена виртуальная среда, установлен API TraCI и изучены некоторые его возможности.
4. Реализован простой пример использования API с изменением скорости транспортного средства во время симуляции.
   
## План на следующую итерацию

1. Изучить возможности изменять маршрут автомобиля через API в ходе симуляции, в том числе и в случае, когда маршрут уже задан через конфигурационный файл.
2. Всегда ли маршрут из одного ребра в другое строится с помощью алгоритма Дейкстры?
3. Изучить список параметров для генерации карт.
4. Изучить возможность генерации карт по таким параметрам, как количество рёбер, глубина и ширина графа.
5. Изучить существующие метрики для оценки связности графа и их применимость к генерации карт с помощью в SUMO.
6. Реализовать скрипт для генерации нескольких карт по заданным параметрам.

## Что нужно изучить в течение семестра

1. Посмотреть аналоги на данную тему, связанную с пропускной способностью сети и обучением с подкреплением.
   
## Трудности

На данный момент их нет.
